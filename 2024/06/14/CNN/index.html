<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8"/>
    
    <meta name="viewport" content="initial-scale=1.0, width=device-width"/>
    <title>
      
        CNN | apt-x
      
    </title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png"/>
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color=""/>
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/normal.ttf);
        font-weight: normal;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css'/>
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  

  <meta name="generator" content="Hexo 8.1.1"></head>
  <body>
    
      <div id="search-mask" style="display:none">
  <div class="search-main" id="search-main">
    <div class="search__head">
      <div class="search-form">
        <svg t="1706347533072"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="7828"
             width="20"
             height="20">
          <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
          </path>
        </svg>
        <input id="search-input" placeholder="搜索文章">
        <svg t="1706361500528"
             id="search-clear"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="4351"
             width="20"
             height="20">
          <path d="M512 562.688l-264.2944 264.2944-50.688-50.688L461.312 512 197.0176 247.7056l50.688-50.688L512 461.312l264.2944-264.2944 50.688 50.688L562.688 512l264.2944 264.2944-50.688 50.688L512 562.688z" fill="#00" p-id="4352">
          </path>
        </svg>
      </div>
    </div>
    <div class="search__body" id="search-result"></div>
    <div class="search__foot"></div>
  </div>
</div>

    
    
    <div class=head>
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg"/>
        </a>
        <input id="navBtn" type="checkbox"/>
        <div class="nav-right">
          
            <div class="search-outer"><div class="search" id="search-btn">
  <svg t="1706347533072"
       class="icon"
       viewBox="0 0 1024 1024"
       version="1.1"
       xmlns="http://www.w3.org/2000/svg"
       p-id="7828"
       width="20"
       height="20">
    <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829"></path>
  </svg>
  <span>搜索</span>
  <span class="search-shortcut-key">Ctrl K</span>
</div></div>
          
          <div class="nav-menu">
            
              
                <a class="nav-menu-item" href="/dev">Dev</a>
              
                <a class="nav-menu-item" href="/sec">Sec</a>
              
            
            
          </div>
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner">
      <div class="post-content__head">
        <div class="post-title">CNN</div>
        <div class="post-info">
          
  


          <span class="post-date">2024-06-14</span>
        </div>
      </div>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <p>import torch<br>import torch.nn as nn<br>import torchvision<br>import torch.utils.data as Data</p>
<p>torch.manual_seed(1)  # 设置随机种子, 用于复现</p>
<h1 id="超参数"><a href="#超参数" class="headerlink" title="超参数"></a>超参数</h1><p>EPOCH &#x3D; 1       # 前向后向传播迭代次数<br>LR &#x3D; 0.001      # 学习率 learning rate<br>BATCH_SIZE &#x3D; 50 # 批量训练时候一次送入数据的size<br>DOWNLOAD_MNIST &#x3D; True </p>
<h1 id="下载mnist手写数据集"><a href="#下载mnist手写数据集" class="headerlink" title="下载mnist手写数据集"></a>下载mnist手写数据集</h1><h1 id="训练集"><a href="#训练集" class="headerlink" title="训练集"></a>训练集</h1><p>train_data &#x3D; torchvision.datasets.MNIST(<br>    root &#x3D; ‘.&#x2F;MNIST&#x2F;‘,<br>    train &#x3D; True,<br>    transform &#x3D; torchvision.transforms.ToTensor(),<br>    download&#x3D;DOWNLOAD_MNIST<br>)</p>
<h1 id="测试集"><a href="#测试集" class="headerlink" title="测试集"></a>测试集</h1><p>test_data &#x3D; torchvision.datasets.MNIST(root&#x3D;’.&#x2F;MNIST&#x2F;‘, train&#x3D;False)  # train设置为False表示获取测试集</p>
<h1 id="一个批训练-50个样本-1-channel通道-图片尺寸-28x28-size-50-1-28-28"><a href="#一个批训练-50个样本-1-channel通道-图片尺寸-28x28-size-50-1-28-28" class="headerlink" title="一个批训练 50个样本, 1 channel通道, 图片尺寸 28x28 size:(50, 1, 28, 28)"></a>一个批训练 50个样本, 1 channel通道, 图片尺寸 28x28 size:(50, 1, 28, 28)</h1><p>train_loader &#x3D; Data.DataLoader(<br>    dataset &#x3D; train_data,<br>    batch_size&#x3D;BATCH_SIZE,<br>    shuffle&#x3D;True<br>) </p>
<h1 id="测试数据预处理；只测试前2000个"><a href="#测试数据预处理；只测试前2000个" class="headerlink" title="测试数据预处理；只测试前2000个"></a>测试数据预处理；只测试前2000个</h1><p>test_x &#x3D; torch.unsqueeze(test_data.data,dim&#x3D;1).float()[:2000] &#x2F; 255.0</p>
<h1 id="shape-from-2000-28-28-to-2000-1-28-28"><a href="#shape-from-2000-28-28-to-2000-1-28-28" class="headerlink" title="shape from (2000, 28, 28) to (2000, 1, 28, 28)"></a>shape from (2000, 28, 28) to (2000, 1, 28, 28)</h1><p>test_y &#x3D; test_data.targets[:2000]</p>
<p>class CNN(nn.Module):<br>    def <strong>init</strong>(self):<br>        super(CNN,self).<strong>init</strong>()</p>
<pre><code>    self.conv1 = nn.Sequential(
        nn.Conv2d(                      # 输入的图片 （1，28，28）
            in_channels=1,
            out_channels=16,            # 经过一个卷积层之后 （16,28,28）
            kernel_size=5,
            stride=1,                    # 如果想要 con2d 出来的图片长宽没有变化, padding=(kernel_size-1)/2 当 stride=1
            padding=2
        ),
        nn.ReLU(),
        nn.MaxPool2d(kernel_size=2)      # 经过池化层处理，维度为（16,14,14）
    )

    self.conv2 = nn.Sequential(
        nn.Conv2d(                         # 输入（16,14,14）
            in_channels=16,
            out_channels=32,
            kernel_size=5,
            stride=1,
            padding=2
        ),                                 # 输出（32,14,14）
        nn.ReLU(),
        nn.MaxPool2d(kernel_size=2)        # 输出（32,7,7）
    )

    self.out = nn.Linear(32*7*7,10)

def forward(self, x):
    x = self.conv1(x)                     #（batch_size,16,14,14）
    x = self.conv2(x)                     # 输出（batch_size,32,7,7）
    x = x.view(x.size(0),-1)              # (batch_size,32*7*7)
    out = self.out(x)                     # (batch_size,10)
    return out
</code></pre>
<p>cnn &#x3D; CNN()<br>optimizer &#x3D; torch.optim.Adam(cnn.parameters(),lr&#x3D;LR) # 定义优化器<br>loss_func &#x3D; nn.CrossEntropyLoss() # 定义损失函数</p>
<p>for epoch in range(EPOCH):</p>
<pre><code>for step,(batch_x,batch_y) in enumerate(train_loader):
    pred_y = cnn(batch_x)
    loss = loss_func(pred_y,batch_y)
    optimizer.zero_grad() # 清空上一层梯度
    loss.backward() # 反向传播
    optimizer.step() # 更新优化器的学习率，一般按照epoch为单位进行更新

    if step % 50 == 0:
        test_output = cnn(test_x)
        pred_y = torch.max(test_output, 1)[1].numpy()  # torch.max(test_out,1)返回的是test_out中每一行最大的数)
                                                            # 返回的形式为torch.return_types.max(
                                                            #           values=tensor([0.7000, 0.9000]),
                                                            #           indices=tensor([2, 2]))
                                                            # 后面的[1]代表获取indices
        print(&#39;Epoch: &#39;, epoch, &#39;| train loss: %.4f&#39; % loss.data.numpy())
</code></pre>
<h1 id="打印前十个测试结果和真实结果进行对比"><a href="#打印前十个测试结果和真实结果进行对比" class="headerlink" title="打印前十个测试结果和真实结果进行对比"></a>打印前十个测试结果和真实结果进行对比</h1><p>test_output &#x3D; cnn(test_x[:10])<br>pred_y &#x3D; torch.max(test_output, 1)[1].numpy()<br>print(pred_y, ‘prediction number’)<br>print(test_y[:10].numpy(), ‘real number’)</p>

      </div>
    </div>
    
      <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({"startOnload":true});
        }
      </script>
    
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2025/07/08/Ollama-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E-CNVD-2025-04094/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>Ollama 未授权访问漏洞 CNVD-2025-04094</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2016/12/07/hello-world/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
      </div>
      Hello World
    </a>
  
</div>

    
    
  </div>

    </div>
    <div class="foot">
  <div class="foot-inner">
    <div class="foot__head">
      
        <div class="foot-line">
          <div class="matts">想</div><div class="matts">要</div><div class="matts">走</div><div class="matts">上</div><div class="matts">那</div><div class="matts">条</div><div class="matts">路</div>
        </div>
      
        <div class="foot-line">
          <div class="matts">就</div><div class="matts">要</div><div class="matts">先</div><div class="matts">成</div><div class="matts">为</div><div class="matts">那</div><div class="matts">条</div><div class="matts">路</div>
        </div>
      
    </div>
    <div class="foot__body">
      
        <div class="foot-item">
          <div class="foot-item__head">朋友</div>
          <div class="foot-item__body">
            
            


  
  
    <div class="foot-link-group">
      
        
        
          <div class="text">
            <img alt="link"
                 height="20px"
                 width="20px"
                 src="/images/icon/icon-link.svg" />
            <a class="foot-link" target="_blank" rel="noopener" href="https://apt-x.cn">apt-x</a>
          </div>
        
      
        
        
          <div class="text">
            <img alt="link"
                 height="20px"
                 width="20px"
                 src="/images/icon/icon-link+.svg" />
            <a class="foot-link" href="mailto:0xd0e0@gmail.com?subject=申请http://example.com的友链">申请友链</a>
          </div>
        
      
        
        
      
        
        
      
    </div>
  


          </div>
        </div>
      
      
        <div class="foot-item">
          <div class="foot-item__head">账号</div>
          <div class="foot-item__body">
            


  
  
    <div class="foot-link-group">
      
        
        
          <div class="text">
            <img alt="link"
                 height="20px"
                 width="20px"
                 src="/images/logo-github.svg" />
            <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/0xd0e0">0xd0e0</a>
          </div>
        
      
        
        
      
        
        
      
        
        
      
    </div>
  


          </div>
        </div>
      
      <div class="foot-item">
        <div class="foot-item__head">联系</div>
        <div class="foot-item__body">
          


  
  
    <div class="foot-link-group">
      
        
        
          <div class="text">
            <img alt="link"
                 height="20px"
                 width="20px"
                 src="/images/icon/icon-email.svg" />
            <a class="foot-link" href="0xd0e0@gmail.com">0xd0e0@gmail.com</a>
          </div>
        
      
        
        
      
        
        
      
        
        
      
    </div>
  


        </div>
      </div>
    </div>
    <div class="copyright">
      <a href="http://example.com">apt-x</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
      <svg width="20" height="20" viewBox="0 0 725 725">
        <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
        <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
        <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
      </svg>
      <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
    </div>
  </div>
</div>

    
    
      <script src="/js/search.js"></script>
      <script>
        searchInitialize("/search.json")
      </script>
    
    <script src="/js/copy-code.js"></script>
    
  

  </body>
</html>